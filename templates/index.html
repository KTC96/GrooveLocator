{% extends "base.html" %} 
{% load static %}
{% block content %} 


    <style>
        

        .legend {
            position: absolute;
            bottom: 275px;
            left: 10px;
            background-color: rgba(102, 0, 204,0.5);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            max-height: 250px;
            overflow-y: auto;
        }

        .legend-btn {
            position: absolute;
            bottom: 205px;
            left: 0;
            padding: 10px;
        
        }

        .legend-img {
            height: 20px;
            width: 20px;
        }
    </style>
    

    <div class="container-fluid">
        <div class="row">
            <div class="col-12 col-lg-9" id="map"></div>
            <div class="col-12 col-lg-3">
                <p class="legend-btn">
                    <button class="btn btn-primary .legend-btn" type="button" data-bs-toggle="collapse"
                        data-bs-target="#legendContent" aria-expanded="false"
                        aria-controls="legendContent">
                        Toggle Legend
                    </button>
                </p>
                <div class="legend collapse collapse-horizontal" id="legendContent">
                    
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Icon</th>
                                <th>Genre</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><img class="legend-img"
                                        src="https://cdn-icons-png.flaticon.com/128/11515/11515653.png" alt="House">
                                </td>
                                <td>House</td>
                            </tr>
                            <tr>
                                <td><img class="legend-img"
                                        src="https://cdn-icons-png.flaticon.com/128/6707/6707113.png" alt="Techno"></td>
                                <td>Techno</td>
                            </tr>
                            <tr>
                                <td><img class="legend-img"
                                        src="https://cdn-icons-png.flaticon.com/128/10413/10413920.png"
                                        alt="Drum and Bass"></td>
                                <td>Drum and Bass</td>
                            </tr>
                            <tr>
                                <td><img class="legend-img" src="https://cdn-icons-png.flaticon.com/128/252/252851.png"
                                        alt="Electro"></td>
                                <td>Electro</td>
                            </tr>
                            <tr>
                                <td><img class="legend-img" src="https://cdn-icons-png.flaticon.com/128/741/741535.png"
                                        alt="Trance"></td>
                                <td>Trance</td>
                            </tr>
                            <tr>
                                <td><img class="legend-img"
                                        src="https://cdn-icons-png.flaticon.com/128/9254/9254089.png" alt="Tech House">
                                </td>
                                <td>Tech House</td>
                            </tr>
                           
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

{% if user.is_authenticated %}
    <style>
        #map {
            height: 80vh;
        }
    </style>
{% endif %}


<script>
    function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
            center: {
                lat: 0,
                lng: 0
            },
            zoom: 10
        });

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var userLatLng = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                map.setCenter(userLatLng);
            }, function () {
                handleLocationError(true, map.getCenter());
            });
        } else {
            handleLocationError(false, map.getCenter());
        }

        function handleLocationError(browserHasGeolocation, pos) {
            var infoWindow = new google.maps.InfoWindow();
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }

        

        var events = [
            {% for event in events %}
            {
                "title": "{{ event.title }}",
                "lat": {{ event.latitude }},
                "lng": {{ event.longitude }},
                "event_genre": "{{ event.event_genre }}",
                "event_venue": "{{ event.event_venue }}",
                "event_date": "{{ event.event_date }}",
                "url": "{% url 'event_details' slug=event.slug %}"
            },
            {% endfor %}
        ];

        for (var i = 0; i < events.length; i++) {
            createMarker(events[i]);
        }

        function createMarker(event) {

            var markerImages = {
            "House": "https://cdn-icons-png.flaticon.com/128/11515/11515653.png",
            "Techno": "https://cdn-icons-png.flaticon.com/128/6707/6707113.png",
            "Drum and Bass": "https://cdn-icons-png.flaticon.com/128/10413/10413920.png",
            "Electro": "https://cdn-icons-png.flaticon.com/128/252/252851.png",
            "Trance" : "https://cdn-icons-png.flaticon.com/128/741/741535.png",
            "Tech House" : "https://cdn-icons-png.flaticon.com/128/9254/9254089.png"
            
            };

            var markerImage = {
            url: markerImages[event.event_genre],
            scaledSize: new google.maps.Size(32, 32) // Adjust the size as needed
            };


            var marker = new google.maps.Marker({
                position: {
                    lat: event.lat,
                    lng: event.lng
                },
                map: map,
                title: event.title,
                icon: markerImage
            });

            var infowindow = new google.maps.InfoWindow({
                content: `<div>
                    <h2>${event.title}</h2>
                    <p>Genre: ${event.event_genre}</p>
                    <p>Venue: ${event.event_venue}</p>
                    <p>Date: ${event.event_date}</p>
                    <p><a href="${event.url}" target="_blank">Event Details</a></p>
                </div>`
            });

            marker.addListener('click', function () {
                infowindow.open(map, marker);
            });
        }
    }
</script>


<section class="about">
    <div class="container">
        <div class="row justify-content-center text-center">
            {% if user.is_authenticated %}
            <h2>Welcome {{user}}</h2>
            {% endif %}
            {% if not user.is_authenticated %}
            <div class="col-12 text-center">
                <h1 class="main-heading p-3">Groove Locator</h1>
            </div>
            <div class="col-sm-8 about-text p-3">
                <p>Welcome to your ultimate destination for discovering the pulse of the dance and electronic music
                    scene! At Groove Locator, we're passionate about connecting music enthusiasts with the beats that move
                    them.Whether you're a seasoned dancer or someone looking to explore the vibrant world of electronic
                    events,we've got you covered.
                </p>
            </div>
            <div class="col-12 text-center button-col p-3">
                <a href="{% url 'account_signup' %}" class="btn btn-primary btn-lg join-btn">Join The Groove</a>
            </div>
        </div>
    </div>

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-12 text-center p-3">
                <h2>What our groovers have to say</h2>
            </div>
           
            <div class="col-md-4 user-testimonials p-3">
                <div class="card">
                    <img src="{% static 'images/user1.jpg' %}" class="card-img-top" alt="...">
                    <div class="card-body">
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of
                            the
                            card's content.</p>
                    </div>
                </div>
            </div>
             <div class="col-md-4 user-testimonials p-3">
                 <div class="card">
                     <img src="{% static 'images/user2.jpg' %}" class="card-img-top" alt="...">
                     <div class="card-body">
                         <p class="card-text">Some quick example text to build on the card title and make up the bulk of
                             the
                             card's content.</p>
                     </div>
                 </div>
             </div>
            <div class="col-md-4 user-testimonials p-3">
                <div class="card">
                    <img src="{% static 'images/user3.jpg' %}" class="card-img-top" alt="...">
                    <div class="card-body">
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of
                            the
                            card's content.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</section>


<!--Jquery-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

<!--JS bootstrap-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-keqaw70FtXos3u3ACeF7TmvlKS6HzG+D00heSbTG5I3ZVT0Cjq/dV9WO0AxiY6PC" crossorigin="anonymous">
</script>
<!--JS-->

<!--Google Maps API-->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDDLv6foLba6R_4ZlNosCqsZft_U8ruFEE&callback=initMap" async
    defer></script>

{% endblock %}